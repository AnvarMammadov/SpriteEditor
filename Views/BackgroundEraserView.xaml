<UserControl x:Class="SpriteEditor.Views.BackgroundEraserView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SpriteEditor.Views"
             xmlns:converters="clr-namespace:SpriteEditor.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="550" d:DesignWidth="880" Background="#FF2D2D30"
             Foreground="#FFE1E1E1">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
        <converters:EnumToVisibilityConverter x:Key="EnumToVisibilityConverter"/>
        <SolidColorBrush x:Key="BgPrimary" Color="#FF2D2D30"/>
        <SolidColorBrush x:Key="BgSecondary" Color="#FF3F3F46"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#FF007ACC"/>
        <SolidColorBrush x:Key="AccentBlueHover" Color="#FF009AFF"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFE1E1E1"/>

    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="{StaticResource BgSecondary}" CornerRadius="5" Padding="10">
            <StackPanel>
                <TextBlock Text="1. Fayl"/>

                <Button Content="Görüntü Yüklə..." 
                        Command="{Binding LoadImageCommand}"
                        Margin="5,5,5,0"/>

                <Button Content="Görüntünü Yenilə" 
                        Command="{Binding RefreshImageCommand}"
                        Margin="5,5,5,5"/>

                <TextBlock Text="Alət Seçimi" Margin="0,15,0,5"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="5">
                    <RadioButton Content="Pipet" 
                                 GroupName="ToolMode" 
                                 IsChecked="{Binding CurrentToolMode, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Pipet}" 
                                 Foreground="White" VerticalAlignment="Center" Margin="5,0"/>
                    <RadioButton Content="Manual Silgi" 
                                 GroupName="ToolMode" 
                                 IsChecked="{Binding CurrentToolMode, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=ManualEraser}" 
                                 Foreground="White" VerticalAlignment="Center" Margin="5,0"/>
                </StackPanel>

                <StackPanel Visibility="{Binding CurrentToolMode, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=ManualEraser}">
                    <TextBlock Text="Fırça Ölçüsü:" Margin="5,10,5,0"/>
                    <TextBlock Text="{Binding BrushSize, StringFormat={}{0}px}" HorizontalAlignment="Center"/>
                    <Slider Minimum="2" Maximum="100" TickFrequency="1" IsSnapToTickEnabled="True"
                            Value="{Binding BrushSize}" Margin="5,0"/>
                </StackPanel>


                <TextBlock Text="2. Parametrlər (Magic Wand)" Margin="0,15,0,0"/>
                <TextBlock Text="Hədəf Rəng:" Margin="5,0"/>
                <Border BorderBrush="White" BorderThickness="1" Height="30" Margin="5">
                    <Border.Background>
                        <SolidColorBrush Color="{Binding TargetColor}"/>
                    </Border.Background>
                </Border>


                <TextBlock Text="Həssaslıq (Tolerance):" Margin="5,10,5,0"/>
                <TextBlock Text="{Binding Tolerance, StringFormat={}{0:F0}%}" HorizontalAlignment="Center"/>
                <Slider Minimum="0" Maximum="100" 
                        Value="{Binding Tolerance}" Margin="5,0"/>

                <TextBlock Text="3. Əməliyyat"/>
                <Button Content="Preview Yarat"
                        Command="{Binding GeneratePreviewCommand}"/>
                <Button Content="Nəticəni Yadda Saxla"
                        Command="{Binding SaveImageCommand}" Margin="5,10,5,5"/>


                <ProgressBar IsIndeterminate="True" 
                             Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}"
                             Height="10" Margin="5,10,5,0"/>
            </StackPanel>
        </Border>

        <Grid Grid.Column="1" Margin="10,0,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Background="#FF1E1E1E" 
                    CornerRadius="5" 
                    Padding="5" 
                    ClipToBounds="True">
                <ScrollViewer x:Name="OriginalImageScrollViewer"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto"
                              PreviewMouseWheel="OriginalImage_PreviewMouseWheel">

                    <Border x:Name="ImageContainerBorder"
                            HorizontalAlignment="Center" 
                            VerticalAlignment="Center">

                        <Grid>
                            <TextBlock Text="ORİJİNAL" Foreground="Gray" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="5"/>

                            <Image Source="{Binding LoadedImageSource}"
                                   MouseLeftButtonDown="OriginalImage_MouseLeftButtonDown"
                                   MouseLeftButtonUp="OriginalImage_MouseLeftButtonUp"
                                   MouseMove="OriginalImage_MouseMove"
                                   Cursor="Cross"
                                   Stretch="Uniform"/>
                        </Grid>

                        <Border.LayoutTransform>
                            <ScaleTransform x:Name="ImageScaleTransform" 
                                            ScaleX="1" ScaleY="1" 
                                            CenterX="0.5" CenterY="0.5"/>
                        </Border.LayoutTransform>

                    </Border>
                </ScrollViewer>
            </Border>

            <Border Grid.Column="1" Background="#FF1E1E1E" CornerRadius="5" Padding="5" Margin="10,0,0,0">
                <Viewbox Stretch="Uniform">
                    <Grid>
                        <Rectangle Fill="{DynamicResource {x:Static SystemColors.ControlLightBrushKey}}"/>
                        <Rectangle Fill="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}">
                            <Rectangle.OpacityMask>
                                <DrawingBrush Viewport="0,0,20,20" ViewportUnits="Absolute" TileMode="Tile">
                                    <DrawingBrush.Drawing>
                                        <GeometryDrawing Brush="Black">
                                            <GeometryDrawing.Geometry>
                                                <GeometryGroup>
                                                    <RectangleGeometry Rect="0,0,10,10"/>
                                                    <RectangleGeometry Rect="10,10,10,10"/>
                                                </GeometryGroup>
                                            </GeometryDrawing.Geometry>
                                        </GeometryDrawing>
                                    </DrawingBrush.Drawing>
                                </DrawingBrush>
                            </Rectangle.OpacityMask>
                        </Rectangle>

                        <TextBlock Text="PREVIEW" Foreground="Gray" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="5"/>
                        <Image Source="{Binding PreviewImageSource}"/>
                    </Grid>
                </Viewbox>
            </Border>
        </Grid>
    </Grid>
</UserControl>
