<UserControl x:Class="SpriteEditor.Views.RiggingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SpriteEditor.Views"
             xmlns:skia="clr-namespace:SkiaSharp.Views.WPF;assembly=SkiaSharp.Views.WPF"
             
             xmlns:vm="clr-namespace:SpriteEditor.ViewModels" 
             xmlns:converters="clr-namespace:SpriteEditor.Converters" 
             mc:Ignorable="d" 
             
             d:DesignHeight="550" d:DesignWidth="880" Background="#FF2D2D30"
             Foreground="#FFE1E1E1">

    <UserControl.Resources>
        <SolidColorBrush x:Key="BgSecondary" Color="#FF3F3F46"/>
        <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#FF007ACC"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFE1E1E1"/>
        <SolidColorBrush x:Key="BgPrimary" Color="#FF2D2D30"/>
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style x:Key="HeaderTextBlock" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,15,0,5"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource BgPrimary}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource AccentBlue}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="{StaticResource BgSecondary}" CornerRadius="5" Padding="10">
            <StackPanel>
                <TextBlock Text="1. Fayl" Style="{StaticResource HeaderTextBlock}"/>
                <Button Content="Görüntü Yüklə..." 
                        Command="{Binding LoadImageCommand}"
                        Margin="5"/>

                <TextBlock Text="2. Skelet Alətləri" Style="{StaticResource HeaderTextBlock}"/>
                <RadioButton Content="Redaktə (Edit)" 
                             GroupName="ToolMode" 
                             IsChecked="{Binding CurrentTool, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:RiggingToolMode.Edit}}"
                             Foreground="White" Margin="5"/>
                <RadioButton Content="Sümük Yarat" 
                             GroupName="ToolMode" 
                             IsChecked="{Binding CurrentTool, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:RiggingToolMode.CreateJoint}}"
                             Foreground="White" Margin="5"/>
                <RadioButton Content="Hərəkət (Pose)" 
                             GroupName="ToolMode" 
                             IsChecked="{Binding CurrentTool, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:RiggingToolMode.Pose}}"
                             Foreground="White" Margin="5"/>

                <TextBlock Text="3. Mesh Alətləri" Style="{StaticResource HeaderTextBlock}"/>

                <RadioButton Content="Mesh Redaktə" 
                             GroupName="ToolMode" 
                             IsChecked="{Binding CurrentTool, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:RiggingToolMode.EditMesh}}"
                             Foreground="White" Margin="5"/>
                <!-- === AutoWeight Parametrləri === -->
                <Expander Header="AutoWeight Parametrləri" Margin="5,0,5,5" IsExpanded="False">
                    <StackPanel Margin="5">
                        <!-- SigmaFactor -->
                        <TextBlock Text="σ (Sümük qalınlığı faktoru)" />
                        <DockPanel>
                            <Slider Minimum="0.05" Maximum="0.40" SmallChange="0.01" TickFrequency="0.05" IsSnapToTickEnabled="False"
                    Value="{Binding AwSigmaFactor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwSigmaFactor, Mode=TwoWay, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <!-- RadialPower -->
                        <TextBlock Text="Radial Güc" Margin="0,8,0,0"/>
                        <DockPanel>
                            <Slider Minimum="0.5" Maximum="2.0" SmallChange="0.1" TickFrequency="0.25"
                    Value="{Binding AwRadialPower, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwRadialPower, Mode=TwoWay, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <!-- LongPower -->
                        <TextBlock Text="Uzunluq Boyu Güc (end-falloff)" Margin="0,8,0,0"/>
                        <DockPanel>
                            <Slider Minimum="0.2" Maximum="1.0" SmallChange="0.1" TickFrequency="0.2"
                    Value="{Binding AwLongPower, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwLongPower, Mode=TwoWay, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <!-- ParentBlend -->
                        <TextBlock Text="Valideynə Pay (Parent Blend)" Margin="0,8,0,0"/>
                        <DockPanel>
                            <Slider Minimum="0.0" Maximum="0.5" SmallChange="0.05" TickFrequency="0.1"
                    Value="{Binding AwParentBlend, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwParentBlend, Mode=TwoWay, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <!-- AncestorDecay -->
                        <TextBlock Text="Yuxarı Nəsil Sönümlənməsi (Ancestor Decay)" Margin="0,8,0,0"/>
                        <DockPanel>
                            <Slider Minimum="0.1" Maximum="0.9" SmallChange="0.05" TickFrequency="0.1"
                    Value="{Binding AwAncestorDecay, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwAncestorDecay, Mode=TwoWay, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <!-- TopK -->
                        <TextBlock Text="Top-K (sümük sayı)" Margin="0,8,0,0"/>
                        <DockPanel>
                            <Slider Minimum="1" Maximum="6" SmallChange="1" TickFrequency="1" IsSnapToTickEnabled="True"
                    Value="{Binding AwTopK, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwTopK, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <!-- MinKeep -->
                        <TextBlock Text="Minimum Çəki (Threshold)" Margin="0,8,0,0"/>
                        <DockPanel>
                            <Slider Minimum="0.00" Maximum="0.10" SmallChange="0.01" TickFrequency="0.02"
                    Value="{Binding AwMinKeep, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwMinKeep, Mode=TwoWay, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <!-- Smoothing -->
                        <TextBlock Text="Smoothing İterasiya" Margin="0,8,0,0"/>
                        <DockPanel>
                            <Slider Minimum="0" Maximum="6" SmallChange="1" TickFrequency="1" IsSnapToTickEnabled="True"
                    Value="{Binding AwSmoothIters, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwSmoothIters, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <TextBlock Text="Smoothing Gücü (μ)" Margin="0,8,0,0"/>
                        <DockPanel>
                            <Slider Minimum="0.05" Maximum="0.6" SmallChange="0.05" TickFrequency="0.1"
                    Value="{Binding AwSmoothMu, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Width="150" Margin="0,0,5,0"/>
                            <TextBox Width="60" Text="{Binding AwSmoothMu, Mode=TwoWay, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>

                        <Button Content="Default-a Qaytar" Command="{Binding ResetAutoWeightDefaultsCommand}" Margin="0,10,0,0"/>
                    </StackPanel>
                </Expander>
                <!-- === /Parametrlər === -->

                <Button Content="Auto Mesh (Nöqtələri Yarat)"
                     Command="{Binding AutoGenerateVerticesCommand}"
                        Margin="5,0,5,6"/>
                <Button Content="Avto Üçbucaq Yarat"
                        Command="{Binding AutoTriangleCommand}"
                        Margin="5,0,5,5"/>

                <Button Content="Avto Ağırlıq Hesabla"
                        Command="{Binding AutoWeightCommand}"
                        Margin="5"/>
                <TextBlock Text="4. Əməliyyatlar" Style="{StaticResource HeaderTextBlock}"/>
                <Button Content="Skeleti Yüklə"
                        Command="{Binding LoadRigCommand}"
                        Margin="5,5,5,0"/>
                <Button Content="Skeleti Yadda Saxla"
                        Command="{Binding SaveRigCommand}"
                        Margin="5,5,5,5"/>

                <StackPanel>
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Setter Property="Visibility" Value="Visible"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedJoint}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="5. Seçilmiş Oynaq" Style="{StaticResource HeaderTextBlock}"/>
                    <TextBlock Text="Ad:" Margin="5,0"/>
                    <TextBox Text="{Binding SelectedJoint.Name, UpdateSourceTrigger=PropertyChanged}" 
                             Margin="5"/>
                </StackPanel>

            </StackPanel>
        </Border>

        <Border x:Name="CanvasBorder" 
                Grid.Column="1" Background="#FF1E1E1E" CornerRadius="5" Margin="10,0,0,0" ClipToBounds="True"
                MouseLeftButtonDown="SKCanvasView_MouseLeftButtonDown"
                MouseLeftButtonUp="SKCanvasView_MouseLeftButtonUp"
                MouseMove="SKCanvasView_MouseMove"
                MouseLeave="SKCanvasView_MouseLeave"
                MouseDown="SKCanvasView_MouseDown"
                MouseUp="SKCanvasView_MouseUp"
                MouseRightButtonDown="SKCanvasView_MouseRightButtonDown"
                PreviewMouseWheel="SKCanvasView_PreviewMouseWheel"
                Focusable="True" 
                KeyDown="CanvasBorder_KeyDown">
            <skia:SKElement x:Name="SKCanvasView"
                            IgnorePixelScaling="True"
                            PaintSurface="SKCanvasView_PaintSurface"
                            SizeChanged="SKCanvasView_SizeChanged"
                            />
        </Border>
    </Grid>
</UserControl>