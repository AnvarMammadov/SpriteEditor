<UserControl x:Class="SpriteEditor.Views.RiggingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SpriteEditor.Views"
             xmlns:skia="clr-namespace:SkiaSharp.Views.WPF;assembly=SkiaSharp.Views.WPF"
             xmlns:vm="clr-namespace:SpriteEditor.ViewModels" 
             xmlns:converters="clr-namespace:SpriteEditor.Converters" 
             mc:Ignorable="d" 
             d:DesignHeight="650" d:DesignWidth="1000" Background="#FF2D2D30"
             Foreground="#FFE1E1E1">

    <UserControl.Resources>
        <SolidColorBrush x:Key="BgSecondary" Color="#FF3F3F46"/>
        <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#FF007ACC"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFE1E1E1"/>
        <SolidColorBrush x:Key="BgPrimary" Color="#FF2D2D30"/>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style x:Key="HeaderTextBlock" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,15,0,5"/>
        </Style>
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource BgPrimary}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource AccentBlue}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="{StaticResource BgSecondary}" CornerRadius="5" Padding="10" Margin="0,0,10,10">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="1. Fayl" Style="{StaticResource HeaderTextBlock}"/>
                        <Button Content="Görüntü Yüklə..." Command="{Binding LoadImageCommand}" Margin="5"/>

                        <TextBlock Text="2. Skelet Alətləri" Style="{StaticResource HeaderTextBlock}"/>
                        <RadioButton Content="Redaktə (Edit)" GroupName="ToolMode" 
                                     IsChecked="{Binding CurrentTool, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:RiggingToolMode.Edit}}"
                                     Foreground="White" Margin="5"/>
                        <RadioButton Content="Sümük Yarat" GroupName="ToolMode" 
                                     IsChecked="{Binding CurrentTool, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:RiggingToolMode.CreateJoint}}"
                                     Foreground="White" Margin="5"/>
                        <RadioButton Content="Hərəkət (Pose)" GroupName="ToolMode" 
                                     IsChecked="{Binding CurrentTool, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:RiggingToolMode.Pose}}"
                                     Foreground="White" Margin="5"/>

                        <TextBlock Text="3. Mesh Alətləri" Style="{StaticResource HeaderTextBlock}"/>
                        <RadioButton Content="Mesh Redaktə" GroupName="ToolMode" 
                                     IsChecked="{Binding CurrentTool, Mode=TwoWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static vm:RiggingToolMode.EditMesh}}"
                                     Foreground="White" Margin="5"/>

                        <Expander Header="AutoWeight Parametrləri" Margin="5,0,5,5" IsExpanded="False" Foreground="White">
                            <StackPanel Margin="5">
                                <TextBlock Text="σ (Sümük qalınlığı)" />
                                <DockPanel>
                                    <Slider Minimum="0.05" Maximum="0.40" Value="{Binding AwSigmaFactor}" Width="150"/>
                                    <TextBox Width="50" Text="{Binding AwSigmaFactor, StringFormat=F2}"/>
                                </DockPanel>

                                <TextBlock Text="Radial Güc" Margin="0,5,0,0"/>
                                <DockPanel>
                                    <Slider Minimum="0.5" Maximum="2.0" Value="{Binding AwRadialPower}" Width="150"/>
                                    <TextBox Width="50" Text="{Binding AwRadialPower, StringFormat=F2}"/>
                                </DockPanel>
                                <Button Content="Default-a Qaytar" Command="{Binding ResetAutoWeightDefaultsCommand}" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Expander>

                        <Button Content="Auto Mesh (Nöqtələri Yarat)" Command="{Binding AutoGenerateVerticesCommand}" Margin="5,5,5,0"/>
                        <Button Content="Avto Üçbucaq Yarat" Command="{Binding AutoTriangleCommand}" Margin="5,5,5,0"/>
                        <Button Content="Avto Ağırlıq Hesabla" Command="{Binding AutoWeightCommand}" Margin="5"/>

                        <TextBlock Text="4. Əməliyyatlar" Style="{StaticResource HeaderTextBlock}"/>
                        <Button Content="Skeleti Yüklə" Command="{Binding LoadRigCommand}" Margin="5,5,5,0"/>
                        <Button Content="Skeleti Yadda Saxla" Command="{Binding SaveRigCommand}" Margin="5,5,5,5"/>

                        <StackPanel>
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedJoint}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                            <TextBlock Text="5. Seçilmiş Oynaq" Style="{StaticResource HeaderTextBlock}"/>
                            <TextBlock Text="Ad:" Margin="5,0"/>
                            <TextBox Text="{Binding SelectedJoint.Name, UpdateSourceTrigger=PropertyChanged}" Margin="5"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <Border x:Name="CanvasBorder" 
                    Grid.Column="1" 
                    Background="#FF1E1E1E" 
                    CornerRadius="5" 
                    Margin="0,0,0,10" 
                    ClipToBounds="True"
                    MouseLeftButtonDown="SKCanvasView_MouseLeftButtonDown"
                    MouseLeftButtonUp="SKCanvasView_MouseLeftButtonUp"
                    MouseMove="SKCanvasView_MouseMove"
                    MouseLeave="SKCanvasView_MouseLeave"
                    MouseDown="SKCanvasView_MouseDown"
                    MouseUp="SKCanvasView_MouseUp"
                    MouseRightButtonDown="SKCanvasView_MouseRightButtonDown"
                    PreviewMouseWheel="SKCanvasView_PreviewMouseWheel"
                    Focusable="True" 
                    KeyDown="CanvasBorder_KeyDown">
                <skia:SKElement x:Name="SKCanvasView"
                                IgnorePixelScaling="True"
                                PaintSurface="SKCanvasView_PaintSurface"
                                SizeChanged="SKCanvasView_SizeChanged"/>
            </Border>
        </Grid>

        <Border Grid.Row="1" 
                Background="{StaticResource BgSecondary}" 
                CornerRadius="5" 
                Height="80" 
                Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,20,0">
                    <Button Command="{Binding StopCommand}" Width="30" Height="30" Margin="2" Background="#FF444444" BorderThickness="0">
                        <Rectangle Width="10" Height="10" Fill="#FFEEEEEE"/>
                    </Button>
                    <Button Command="{Binding PauseCommand}" Width="30" Height="30" Margin="2" Background="#FF444444" BorderThickness="0">
                        <Grid Width="10" Height="10">
                            <Rectangle Width="3" Height="10" Fill="#FFEEEEEE" HorizontalAlignment="Left"/>
                            <Rectangle Width="3" Height="10" Fill="#FFEEEEEE" HorizontalAlignment="Right"/>
                        </Grid>
                    </Button>
                    <Button Command="{Binding PlayCommand}" Width="40" Height="40" Margin="5,0" Background="{StaticResource AccentBlue}" BorderThickness="0">
                        <Polygon Points="0,0 12,7 0,14" Fill="White" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="2,0,0,0"/>
                    </Button>
                </StackPanel>

                <Grid Grid.Column="1" VerticalAlignment="Center" Margin="10,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Left" Margin="2,0,0,2">
                        <TextBlock Text="{Binding CurrentTime, StringFormat=N2}" Foreground="#FF00A8FF" FontWeight="Bold" FontSize="14"/>
                        <TextBlock Text=" / " Foreground="Gray" Margin="5,0"/>
                        <TextBlock Text="{Binding TotalDuration, StringFormat=N2}" Foreground="Gray"/>
                        <TextBlock Text=" s" Foreground="Gray"/>
                    </StackPanel>

                    <Slider Grid.Row="1" 
                            Minimum="0" 
                            Maximum="{Binding TotalDuration}" 
                            Value="{Binding CurrentTime, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            TickFrequency="0.1" 
                            IsSnapToTickEnabled="False" 
                            LargeChange="0.1"
                            VerticalAlignment="Center"/>
                </Grid>

                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="20,0,0,0">
                    <Button Command="{Binding AddKeyframeCommand}" 
                            Background="#FF28A745" 
                            Foreground="White" 
                            FontWeight="Bold" 
                            Height="35" 
                            Padding="15,0"
                            BorderThickness="0"
                            Cursor="Hand">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="+" FontSize="16" Margin="0,0,5,2"/>
                            <TextBlock Text="Keyframe"/>
                        </StackPanel>
                    </Button>
                    <TextBlock Text="Sümüyü seç və əlavə et" FontSize="10" Foreground="Gray" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>