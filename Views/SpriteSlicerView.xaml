<UserControl x:Class="SpriteEditor.Views.SpriteSlicerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SpriteEditor.Views"
             mc:Ignorable="d" 
             d:DesignHeight="550" d:DesignWidth="880"
             
             Background="#FF2D2D30"
             Foreground="#FFE1E1E1">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        
        <SolidColorBrush x:Key="BgPrimary" Color="#FF2D2D30"/>
        <SolidColorBrush x:Key="BgSecondary" Color="#FF3F3F46"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#FF007ACC"/>
        <SolidColorBrush x:Key="AccentBlueHover" Color="#FF009AFF"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFE1E1E1"/>
        <SolidColorBrush x:Key="SlicerBrush" Color="LimeGreen"/>

        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource AccentBlue}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="3">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentBlueHover}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource BgPrimary}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource AccentBlue}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource AccentBlue}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,15,0,5"/>
        </Style>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
        </Style>

        <Style x:Key="ResizeThumbStyle" TargetType="Thumb">
            <Setter Property="Width" Value="10"/>
            <Setter Property="Height" Value="10"/>
            <Setter Property="Background" Value="{StaticResource SlicerBrush}"/>
            <Setter Property="BorderBrush" Value="Black"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Rectangle Fill="{TemplateBinding Background}"
                                   Stroke="{TemplateBinding BorderBrush}"
                                   StrokeThickness="{TemplateBinding BorderThickness}"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


    </UserControl.Resources>


    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" 
                Background="{StaticResource BgSecondary}" 
                CornerRadius="5" 
                Padding="10">

            <StackPanel>
                <TextBlock Text="1. Fayl Əməliyyatları" Style="{StaticResource HeaderTextBlock}"/>

                <Button Content="Görüntü Yüklə..." 
                        Command="{Binding LoadImageCommand}"/>

                <TextBlock Text="2. Spritesheet Parametrləri" Style="{StaticResource HeaderTextBlock}"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Sütun sayı:"/>
                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding Columns, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Sətr sayı:"/>
                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Rows, UpdateSourceTrigger=PropertyChanged}"/>
                </Grid>

                <Button Content="Spritları Kəs" 
                    Margin="5,20,5,5" 
                    Command="{Binding SliceImageCommand}"/>
                <ProgressBar IsIndeterminate="True" 
                             Visibility="{Binding IsSlicing, Converter={StaticResource BooleanToVisibilityConverter}}"
                             Height="10" Margin="5,0"/>
            </StackPanel>
        </Border>

        <Border Grid.Column="1" 
                Background="#FF1E1E1E" 
                CornerRadius="5" 
                Margin="10,0,0,0"
                ClipToBounds="True">
            <Viewbox Stretch="Uniform">
                <Grid Width="{Binding ImagePixelWidth}" 
                      Height="{Binding ImagePixelHeight}">

                    <Image Source="{Binding LoadedImageSource}"/>

                    <ItemsControl ItemsSource="{Binding GridLines}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <Canvas/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Line X1="{Binding X1}" 
                                      Y1="{Binding Y1}" 
                                      X2="{Binding X2}" 
                                      Y2="{Binding Y2}"
                                      Stroke="#FF007ACC" 
                                      StrokeThickness="2"
                                      StrokeDashArray="4 2"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <Canvas x:Name="SlicerCanvas">

                        <Border x:Name="SlicerBorder"
                                Canvas.Left="{Binding SlicerX}"
                                Canvas.Top="{Binding SlicerY}"
                                Width="{Binding SlicerWidth}"
                                Height="{Binding SlicerHeight}"
                                BorderBrush="{StaticResource SlicerBrush}"
                                BorderThickness="2"
                                Background="#3300FF00" 
                                IsHitTestVisible="False"/>
                        <Thumb x:Name="ThumbMove"
                               Canvas.Left="{Binding SlicerX}"
                               Canvas.Top="{Binding SlicerY}"
                               Width="{Binding SlicerWidth}"
                               Height="{Binding SlicerHeight}"
                               Cursor="SizeAll"
                               Opacity="0"
                               DragDelta="ThumbMove_DragDelta" />

                        <Thumb x:Name="ThumbTopLeft" Cursor="SizeNWSE" Style="{StaticResource ResizeThumbStyle}" DragDelta="ThumbResize_DragDelta"/>
                        <Thumb x:Name="ThumbTopRight" Cursor="SizeNESW" Style="{StaticResource ResizeThumbStyle}" DragDelta="ThumbResize_DragDelta"/>
                        <Thumb x:Name="ThumbBottomLeft" Cursor="SizeNESW" Style="{StaticResource ResizeThumbStyle}" DragDelta="ThumbResize_DragDelta"/>
                        <Thumb x:Name="ThumbBottomRight" Cursor="SizeNWSE" Style="{StaticResource ResizeThumbStyle}" DragDelta="ThumbResize_DragDelta"/>

                        <Thumb x:Name="ThumbTop" Cursor="SizeNS" Style="{StaticResource ResizeThumbStyle}" DragDelta="ThumbResize_DragDelta"/>
                        <Thumb x:Name="ThumbBottom" Cursor="SizeNS" Style="{StaticResource ResizeThumbStyle}" DragDelta="ThumbResize_DragDelta"/>
                        <Thumb x:Name="ThumbLeft" Cursor="SizeWE" Style="{StaticResource ResizeThumbStyle}" DragDelta="ThumbResize_DragDelta"/>
                        <Thumb x:Name="ThumbRight" Cursor="SizeWE" Style="{StaticResource ResizeThumbStyle}" DragDelta="ThumbResize_DragDelta"/>

                    </Canvas>

                </Grid>
            </Viewbox>
        </Border>

    </Grid>
</UserControl>