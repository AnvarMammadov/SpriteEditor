<UserControl x:Class="SpriteEditor.Views.TemplateRiggingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:SpriteEditor.Views"
             xmlns:controls="clr-namespace:SpriteEditor.Views.Controls"
             xmlns:skia="clr-namespace:SkiaSharp.Views.WPF;assembly=SkiaSharp.Views.WPF"
             xmlns:vm="clr-namespace:SpriteEditor.ViewModels" 
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000">


    <Grid Background="{StaticResource Brush.Bg.Deep}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>    <!-- Main content -->
            <RowDefinition Height="Auto"/> <!-- Timeline (collapsible) -->
        </Grid.RowDefinitions>

        <!-- Main Content Grid -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

        <!-- LEFT PANEL -->
        <Border Grid.Column="0" Background="{StaticResource Brush.Bg.Panel}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="0,0,1,0" Padding="20">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <TextBlock Text="ðŸŽ¯ TEMPLATE RIGGING" FontWeight="Bold" Foreground="{StaticResource Brush.Accent.Primary}" FontSize="14" Margin="0,0,0,15"/>
                    <TextBlock Text="Zero-configuration rigging with physics!" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="11" Margin="0,0,0,25" TextWrapping="Wrap"/>

                    <!-- STEP 1: LOAD SPRITE -->
                    <TextBlock Text="1ï¸âƒ£ Load Sprite" FontWeight="Bold" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="12" Margin="0,0,0,10"/>
                    <Button Content="ðŸ“ Load Sprite" Command="{Binding LoadSpriteCommand}" Style="{StaticResource Style.Button.Primary}" Margin="0,0,0,20"/>

                    <Separator Background="{StaticResource Brush.Border}" Margin="0,0,0,20" Opacity="0.3"/>

                    <!-- STEP 2: SELECT TEMPLATE -->
                    <TextBlock Text="2ï¸âƒ£ Select Template" FontWeight="Bold" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="12" Margin="0,0,0,10"/>
                    <Button Content="ðŸ‘¤ Humanoid" Command="{Binding SelectTemplateCommand}" CommandParameter="Humanoid" Style="{StaticResource Style.Button.Accent}" Margin="0,0,0,10"/>
                    <TextBlock Text="(More templates coming soon)" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="10" Margin="0,0,0,20" Opacity="0.5"/>

                    <Separator Background="{StaticResource Brush.Border}" Margin="0,0,0,20" Opacity="0.3"/>

                    <!-- STEP 3: FIT OVERLAY -->
                    <StackPanel>
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsOverlayVisible}" Value="False">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="3ï¸âƒ£ Fit Template" FontWeight="Bold" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="12" Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Scale" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="11" Margin="0,0,0,5"/>
                        <Slider Minimum="0.5" Maximum="2.0" Value="{Binding OverlayScale}" Margin="0,0,0,10"/>

                        <TextBlock Text="Opacity" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="11" Margin="0,0,0,5"/>
                        <Slider Minimum="0.1" Maximum="1.0" Value="{Binding OverlayOpacity}" Margin="0,0,0,10"/>

                       <TextBlock Text="Drag overlay to position" Foreground="{StaticResource Brush.Accent.Blue}" FontSize="10" Margin="0,0,0,20" TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- STEP 4: BIND -->
                    <Button Content="âœ¨ BIND TEMPLATE" Command="{Binding BindTemplateCommand}" 
                            Style="{StaticResource Style.Button.Primary}"
                            Background="#10B981"
                            Height="50"
                            FontSize="16"
                            FontWeight="Bold"
                            Margin="0,0,0,20"/>

                    <Separator Background="{StaticResource Brush.Border}" Margin="0,0,0,20" Opacity="0.3"/>

                    <!-- STEP 5: PHYSICS -->
                    <StackPanel>
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Setter Property="Visibility" Value="Visible"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsTemplateBound}" Value="False">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <TextBlock Text="5ï¸âƒ£ Physics Pose" FontWeight="Bold" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="12" Margin="0,0,0,10"/>
                        
                        <Button Content="ðŸŽ® Start Physics" Command="{Binding StartPhysicsCommand}" Style="{StaticResource Style.Button.Accent}" Margin="0,0,0,10"/>
                        <Button Content="â¹ Stop Physics" Command="{Binding StopPhysicsCommand}" Style="{StaticResource Style.Button.Primary}" Margin="0,0,0,10"/>

                        <TextBlock Text="Gravity" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="11" Margin="0,10,0,5"/>
                        <Slider Minimum="0" Maximum="1000" Value="{Binding Gravity}" Margin="0,0,0,10"/>

                        <TextBlock Text="Damping" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="11" Margin="0,0,0,5"/>
                        <Slider Minimum="0.8" Maximum="1.0" Value="{Binding Damping}" Margin="0,0,0,20"/>
                    </StackPanel>

                    <!-- RESET -->
                    <Button Content="ðŸ”„ Reset All" Command="{Binding ResetCommand}" Style="{StaticResource Style.Button.Primary}" Margin="0,0,0,10"/>

                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- RIGHT CANVAS -->
        <Grid Grid.Column="1">
            <Grid.Background>
                <DrawingBrush Viewport="0,0,20,20" ViewportUnits="Absolute" TileMode="Tile">
                    <DrawingBrush.Drawing>
                        <GeometryDrawing>
                            <GeometryDrawing.Pen>
                                <Pen Brush="#1F2937" Thickness="1"/>
                            </GeometryDrawing.Pen>
                            <GeometryDrawing.Geometry>
                                <GeometryGroup>
                                    <LineGeometry StartPoint="0,0" EndPoint="0,20"/>
                                    <LineGeometry StartPoint="0,0" EndPoint="20,0"/>
                                </GeometryGroup>
                            </GeometryDrawing.Geometry>
                        </GeometryDrawing>
                    </DrawingBrush.Drawing>
                </DrawingBrush>
            </Grid.Background>

            <Rectangle Fill="#0F1218" Opacity="0.9" IsHitTestVisible="False"/>

            <!-- CANVAS (SkiaSharp with GPU Acceleration) -->
            <skia:SKElement x:Name="SKCanvasView" 
                            IgnorePixelScaling="False"
                            PaintSurface="SKCanvasView_PaintSurface"
                            MouseLeftButtonDown="Canvas_MouseLeftButtonDown"
                            MouseMove="Canvas_MouseMove"
                            MouseLeftButtonUp="Canvas_MouseLeftButtonUp"
                            MouseDown="Canvas_MouseDown"
                            MouseUp="Canvas_MouseUp"
                            MouseWheel="Canvas_MouseWheel"/>

            <!-- INFO OVERLAY -->
            <Border HorizontalAlignment="Left" VerticalAlignment="Top" Margin="15" Background="#CC111827" CornerRadius="4" Padding="10,5" IsHitTestVisible="False">
                <StackPanel>
                    <TextBlock Text="Template Rigging (BETA)" FontWeight="Bold" Foreground="{StaticResource Brush.Accent.Primary}"/>
                    <TextBlock Text="Zero-config physics rigging" FontSize="10" Foreground="Gray" Margin="0,2,0,0"/>
                </StackPanel>
            </Border>

            <!-- STATUS -->
            <Border HorizontalAlignment="Center" VerticalAlignment="Center" Background="#CC111827" CornerRadius="8" Padding="30,20">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSpriteLoaded}" Value="True">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>

                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ‘ˆ Start by loading a sprite" FontSize="16" Foreground="{StaticResource Brush.Text.Primary}" HorizontalAlignment="Center"/>
                    <TextBlock Text="PNG with transparent background works best" FontSize="12" Foreground="{StaticResource Brush.Text.Secondary}" Margin="0,5,0,0" HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>
        </Grid> <!-- End Main Content Grid -->

        <!-- ANIMATION TIMELINE (Bottom Panel) -->
        <Border Grid.Row="1" 
                Height="180"
                BorderBrush="{StaticResource Brush.Border}"
                BorderThickness="0,1,0,0">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsTemplateBound}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Animation Toolbar -->
                <Border Grid.Row="0" Background="#111827" Padding="10,5">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸŽ¬ ANIMATION" 
                                   Foreground="{StaticResource Brush.Accent.Primary}" 
                                   FontWeight="Bold" 
                                   FontSize="13"
                                   VerticalAlignment="Center"
                                   Margin="0,0,20,0"/>

                        <Button Content="âº Record Mode" 
                                Command="{Binding ToggleRecordModeCommand}"
                                Height="28"
                                Padding="12,0"
                                Margin="0,0,10,0">
                            <Button.Style>
                                <Style TargetType="Button" BasedOn="{StaticResource Style.Button.Accent}">
                                    <Setter Property="Background" Value="#374151"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding AnimationVM.IsRecordingMode}" Value="True">
                                            <Setter Property="Background" Value="#DC2626"/>
                                            <Setter Property="Content" Value="âº Recording..."/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>

                        <TextBlock Text="Enabled animations use Physics for posing, then record keyframes for smooth playback." 
                                   Foreground="{StaticResource Brush.Text.Secondary}" 
                                   FontSize="10"
                                   VerticalAlignment="Center"
                                   Opacity="0.7"
                                   Margin="0,0,10,0"/>
                    </StackPanel>
                </Border>

                <!-- Timeline Control -->
                <controls:AnimationTimelineControl Grid.Row="1" DataContext="{Binding AnimationVM}"/>
            </Grid>
        </Border>

    </Grid>
</UserControl>
